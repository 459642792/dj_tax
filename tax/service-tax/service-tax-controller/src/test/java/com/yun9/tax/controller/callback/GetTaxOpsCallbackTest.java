package com.yun9.tax.controller.callback;

import com.alibaba.fastjson.JSON;
import com.yun9.biz.task.BizTaskService;
import com.yun9.service.tax.controller.TaskCallBackController;
import com.yun9.service.tax.core.task.callback.TaskCallBackResponse;
import com.yun9.tax.controller.BaseTest;
import org.junit.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;

import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;

/**
 * @author lvpanfeng
 * @version 1.0
 * @since 2018-04-28 15:59
 */

public class GetTaxOpsCallbackTest extends BaseTest {
    @Autowired
    TaskCallBackController taskCallBackController;
    @Autowired
    BizTaskService bizTaskService;
    private String seq;

    @Test
    public void callbackGetTaxOps() throws Exception {
        String requestBody = "{\"accountCycleSn\":\"201806\",\"bizId\":\"B4E824F3501811E8871FF5C62F98DD47\",\"body\":\"{\\\"atricles\\\":{\\\"shenzhenArticleDetails\\\":[],\\\"success\\\":false},\\\"bankInfoList\\\":[],\\\"clientInfo\\\":[{\\\"accountingType\\\":\\\"独立核算自负盈亏\\\",\\\"businessAcceptancePoint\\\":\\\"深圳市前海地方税务局办税服务科\\\",\\\"businessAddress\\\":\\\"深圳市前海深港合作区前湾一路1号A栋201室（入驻深圳市前海商务秘书有限公司）\\\",\\\"businessPostCode\\\":\\\"\\\",\\\"businessScope\\\":\\\"\\\",\\\"businessTel\\\":\\\"\\\",\\\"clientFullName\\\":\\\"前海洪祥实业（深圳）有限公司\\\",\\\"companyType\\\":\\\"\\\",\\\"companyTypeFist\\\":\\\"\\\",\\\"creditCode\\\":\\\"91440300MA5DFPE82A\\\",\\\"employee\\\":\\\"\\\",\\\"employeeNumber\\\":\\\"\\\",\\\"fixedEmployeeNumber\\\":\\\"\\\",\\\"foreignEmployee\\\":\\\"\\\",\\\"frManager\\\":\\\"程少慧\\\",\\\"frManagerAddress\\\":\\\"\\\",\\\"frManagerCardCode\\\":\\\"\\\",\\\"frManagerCardName\\\":\\\"\\\",\\\"frManagerCardNumber\\\":\\\"\\\",\\\"frManagerMobilePhone\\\":\\\"18575542556\\\",\\\"frManagerTel\\\":\\\"\\\",\\\"gdCommonFlag\\\":\\\"\\\",\\\"legalPerson\\\":\\\"周茂华\\\",\\\"legalPersonAddress\\\":\\\"\\\",\\\"legalPersonCardCode\\\":\\\"\\\",\\\"legalPersonCardName\\\":\\\"\\\",\\\"legalPersonCardNum\\\":\\\"\\\",\\\"legalPersonMobilePhone\\\":\\\"13008819924\\\",\\\"legalPersonTel\\\":\\\"\\\",\\\"manageTaxAddress\\\":\\\"深圳市前海地方税务局办税服务科\\\",\\\"nsrStatus\\\":\\\"正常\\\",\\\"openStartDate\\\":\\\"2016-07-01\\\",\\\"organizationCode\\\":\\\"\\\",\\\"partners\\\":\\\"\\\",\\\"registerAddress\\\":\\\"深圳市前海深港合作区前湾一路1号A栋201室（入驻深圳市前海商务秘书有限公司）\\\",\\\"registerDate\\\":\\\"\\\",\\\"registerFunds\\\":\\\"\\\",\\\"registerNum\\\":\\\"\\\",\\\"registerPhone\\\":\\\"\\\",\\\"registerPostCode\\\":\\\"\\\",\\\"registerType\\\":\\\"私营有限责任公司\\\",\\\"runStartDate\\\":\\\"2016-07-01\\\",\\\"street\\\":\\\"粤海街道\\\",\\\"taxManAddress\\\":\\\"\\\",\\\"taxManCardCode\\\":\\\"\\\",\\\"taxManCardName\\\":\\\"\\\",\\\"taxManCardNumber\\\":\\\"\\\",\\\"taxManName\\\":\\\"刘显元\\\",\\\"taxManPhoneNum\\\":\\\"18898752599\\\",\\\"taxManStatusCode\\\":\\\"\\\",\\\"taxManTel\\\":\\\"\\\",\\\"taxNo\\\":\\\"91440300MA5DFPE82A\\\",\\\"taxRegisterType\\\":\\\"单位纳税人税务登记\\\",\\\"zgswskfjDm\\\":\\\"\\\",\\\"zzlxmc\\\":\\\"\\\",\\\"zzsnsrlx\\\":\\\"\\\"}],\\\"dsData\\\":true,\\\"gsData\\\":false,\\\"personalInfo\\\":{\\\"code\\\":200,\\\"data\\\":[{\\\"allowdeduction\\\":\\\"0\\\",\\\"alreadycosttax\\\":\\\"0\\\",\\\"cardnumber\\\":\\\"513723198609158847\\\",\\\"cardtype\\\":\\\"201\\\",\\\"countryid\\\":\\\"156\\\",\\\"deduction\\\":\\\"0\\\",\\\"deductionamount\\\":\\\"3500\\\",\\\"deductiondonate\\\":\\\"0\\\",\\\"dutyfreeamount\\\":\\\"0\\\",\\\"finallytax\\\":\\\"0\\\",\\\"healthinsurance\\\":\\\"0\\\",\\\"housingfund\\\":\\\"0\\\",\\\"insurance\\\":\\\"0\\\",\\\"itemcode\\\":\\\"0101\\\",\\\"itemname\\\":\\\"正常工资薪金\\\",\\\"name\\\":\\\"周茂华\\\",\\\"nianjin\\\":\\\"0\\\",\\\"originalproperty\\\":\\\"0\\\",\\\"other\\\":\\\"0\\\",\\\"pension\\\":\\\"0\\\",\\\"relieftax\\\":\\\"0\\\",\\\"remarks\\\":\\\"\\\",\\\"shouldcosttax\\\":\\\"0\\\",\\\"shouldpaytax\\\":\\\"0\\\",\\\"speeddeduction\\\":\\\"0\\\",\\\"taxincome\\\":\\\"0\\\",\\\"taxrate\\\":\\\"0.03\\\",\\\"total\\\":\\\"0\\\",\\\"unemploymentinsurance\\\":\\\"0\\\",\\\"wage\\\":\\\"3500\\\",\\\"zspmGyDm\\\":\\\"\\\"}],\\\"message\\\":\\\"查询到1条数据\\\"},\\\"taxCategorys\\\":[{\\\"alreadyDeclared\\\":\\\"N\\\",\\\"alreadyPay\\\":\\\"N\\\",\\\"candeclare\\\":\\\"Y\\\",\\\"closeDate\\\":null,\\\"currentList\\\":[],\\\"cycle\\\":\\\"2018-06-01~2018-06-30\\\",\\\"data\\\":null,\\\"declareDate\\\":null,\\\"djxh\\\":\\\"\\\",\\\"endDate\\\":1530288000000,\\\"files\\\":null,\\\"historyList\\\":[],\\\"itemCode\\\":\\\"101060100\\\",\\\"itemName\\\":\\\"工资薪金所得\\\",\\\"msg\\\":\\\"\\\",\\\"name\\\":\\\"个人所得税\\\",\\\"overdues\\\":null,\\\"payDate\\\":\\\"\\\",\\\"payFiles\\\":null,\\\"payMessage\\\":\\\"\\\",\\\"personaltaxaData\\\":[],\\\"personaltaxaHistory\\\":{},\\\"pmList\\\":[],\\\"pzxh\\\":\\\"\\\",\\\"remark\\\":\\\"\\\",\\\"reportData\\\":null,\\\"sbrq\\\":\\\"\\\",\\\"sbzlhdxx\\\":null,\\\"sbztms\\\":\\\"\\\",\\\"sl\\\":\\\"\\\",\\\"sn\\\":\\\"101060100\\\",\\\"startDate\\\":1527782400000,\\\"state\\\":\\\"\\\",\\\"taxCustomData\\\":{},\\\"taxOfficePayAmount\\\":\\\"\\\",\\\"taxSn\\\":\\\"10106\\\",\\\"taxoffice\\\":\\\"\\\",\\\"type\\\":\\\"\\\",\\\"tzfmc\\\":\\\"\\\",\\\"ybtse\\\":\\\"\\\"},{\\\"alreadyDeclared\\\":\\\"Y\\\",\\\"alreadyPay\\\":\\\"N\\\",\\\"candeclare\\\":\\\"N\\\",\\\"closeDate\\\":null,\\\"currentList\\\":[],\\\"cycle\\\":\\\"2018-04-01~2018-06-30\\\",\\\"data\\\":null,\\\"declareDate\\\":1528819200000,\\\"djxh\\\":\\\"\\\",\\\"endDate\\\":1530288000000,\\\"files\\\":null,\\\"historyList\\\":[],\\\"itemCode\\\":\\\"302160200\\\",\\\"itemName\\\":\\\"增值税地方教育附加\\\",\\\"msg\\\":\\\"\\\",\\\"name\\\":\\\"地方教育附加\\\",\\\"overdues\\\":null,\\\"payDate\\\":\\\"\\\",\\\"payFiles\\\":null,\\\"payMessage\\\":\\\"\\\",\\\"personaltaxaData\\\":[],\\\"personaltaxaHistory\\\":{},\\\"pmList\\\":[{\\\"cycleType\\\":\\\"q\\\",\\\"detailCode\\\":\\\"101090101\\\",\\\"itemCode\\\":\\\"10109\\\",\\\"itemName\\\":\\\"市区（增值税附征）\\\",\\\"taxEndDate\\\":\\\"9999-12-31\\\",\\\"taxRate\\\":\\\"0.07\\\",\\\"taxStartDate\\\":\\\"2018-07-01\\\"},{\\\"cycleType\\\":\\\"q\\\",\\\"detailCode\\\":\\\"302030100\\\",\\\"itemCode\\\":\\\"30203\\\",\\\"itemName\\\":\\\"增值税教育费附加\\\",\\\"taxEndDate\\\":\\\"9999-12-31\\\",\\\"taxRate\\\":\\\"0.03\\\",\\\"taxStartDate\\\":\\\"2018-07-01\\\"},{\\\"cycleType\\\":\\\"q\\\",\\\"detailCode\\\":\\\"302160100\\\",\\\"itemCode\\\":\\\"30216\\\",\\\"itemName\\\":\\\"增值税地方教育附加\\\",\\\"taxEndDate\\\":\\\"9999-12-31\\\",\\\"taxRate\\\":\\\"0.02\\\",\\\"taxStartDate\\\":\\\"2018-07-01\\\"}],\\\"pzxh\\\":\\\"10024418000021697154\\\",\\\"remark\\\":\\\"\\\",\\\"reportData\\\":null,\\\"sbrq\\\":\\\"\\\",\\\"sbzlhdxx\\\":null,\\\"sbztms\\\":\\\"\\\",\\\"sl\\\":\\\"\\\",\\\"sn\\\":\\\"302160200\\\",\\\"startDate\\\":1522512000000,\\\"state\\\":\\\"\\\",\\\"taxCustomData\\\":{},\\\"taxOfficePayAmount\\\":\\\"\\\",\\\"taxSn\\\":\\\"30216\\\",\\\"taxoffice\\\":\\\"\\\",\\\"type\\\":\\\"\\\",\\\"tzfmc\\\":\\\"\\\",\\\"ybtse\\\":\\\"0\\\"},{\\\"alreadyDeclared\\\":\\\"Y\\\",\\\"alreadyPay\\\":\\\"N\\\",\\\"candeclare\\\":\\\"N\\\",\\\"closeDate\\\":null,\\\"currentList\\\":[],\\\"cycle\\\":\\\"2018-06-01~2018-06-30\\\",\\\"data\\\":null,\\\"declareDate\\\":1528819200000,\\\"djxh\\\":\\\"\\\",\\\"endDate\\\":1530288000000,\\\"files\\\":null,\\\"historyList\\\":[],\\\"itemCode\\\":\\\"302160100\\\",\\\"itemName\\\":\\\"增值税地方教育附加\\\",\\\"msg\\\":\\\"\\\",\\\"name\\\":\\\"地方教育附加\\\",\\\"overdues\\\":null,\\\"payDate\\\":\\\"\\\",\\\"payFiles\\\":null,\\\"payMessage\\\":\\\"\\\",\\\"personaltaxaData\\\":[],\\\"personaltaxaHistory\\\":{},\\\"pmList\\\":[{\\\"cycleType\\\":\\\"m\\\",\\\"detailCode\\\":\\\"101090101\\\",\\\"itemCode\\\":\\\"101090101\\\",\\\"itemName\\\":\\\"市区（增值税附征）\\\",\\\"taxEndDate\\\":\\\"\\\",\\\"taxRate\\\":\\\"\\\",\\\"taxStartDate\\\":\\\"\\\"},{\\\"cycleType\\\":\\\"m\\\",\\\"detailCode\\\":\\\"302160100\\\",\\\"itemCode\\\":\\\"302160100\\\",\\\"itemName\\\":\\\"增值税地方教育附加\\\",\\\"taxEndDate\\\":\\\"\\\",\\\"taxRate\\\":\\\"\\\",\\\"taxStartDate\\\":\\\"\\\"},{\\\"cycleType\\\":\\\"m\\\",\\\"detailCode\\\":\\\"302030100\\\",\\\"itemCode\\\":\\\"302030100\\\",\\\"itemName\\\":\\\"增值税教育费附加\\\",\\\"taxEndDate\\\":\\\"\\\",\\\"taxRate\\\":\\\"\\\",\\\"taxStartDate\\\":\\\"\\\"}],\\\"pzxh\\\":\\\"10024418000021697154\\\",\\\"remark\\\":\\\"\\\",\\\"reportData\\\":null,\\\"sbrq\\\":\\\"\\\",\\\"sbzlhdxx\\\":null,\\\"sbztms\\\":\\\"\\\",\\\"sl\\\":\\\"\\\",\\\"sn\\\":\\\"302160100\\\",\\\"startDate\\\":1527782400000,\\\"state\\\":\\\"\\\",\\\"taxCustomData\\\":{},\\\"taxOfficePayAmount\\\":\\\"\\\",\\\"taxSn\\\":\\\"30216\\\",\\\"taxoffice\\\":\\\"\\\",\\\"type\\\":\\\"\\\",\\\"tzfmc\\\":\\\"\\\",\\\"ybtse\\\":\\\"0\\\"}],\\\"taxRegisterList\\\":[{\\\"cycleType\\\":\\\"m\\\",\\\"pmList\\\":[{\\\"cycleType\\\":\\\"m\\\",\\\"detailCode\\\":\\\"101060100\\\",\\\"itemCode\\\":\\\"10106\\\",\\\"itemName\\\":\\\"工资薪金所得\\\",\\\"taxEndDate\\\":\\\"9999-12-31\\\",\\\"taxRate\\\":\\\"0.2\\\",\\\"taxStartDate\\\":\\\"2016-07-01\\\"}],\\\"pmdmCode\\\":\\\"\\\",\\\"qxqz\\\":\\\"9999-12-31\\\",\\\"sl\\\":\\\"0.2\\\",\\\"sn\\\":\\\"101060100\\\",\\\"taxCode\\\":\\\"101060100\\\",\\\"xmdmCode\\\":\\\"\\\",\\\"zcqq\\\":\\\"2016-07-01\\\",\\\"zspmMc\\\":\\\"工资薪金所得\\\",\\\"zsxmMc\\\":\\\"个人所得税\\\"},{\\\"cycleType\\\":\\\"q\\\",\\\"pmList\\\":[{\\\"cycleType\\\":\\\"q\\\",\\\"detailCode\\\":\\\"101090101\\\",\\\"itemCode\\\":\\\"10109\\\",\\\"itemName\\\":\\\"市区（增值税附征）\\\",\\\"taxEndDate\\\":\\\"9999-12-31\\\",\\\"taxRate\\\":\\\"0.07\\\",\\\"taxStartDate\\\":\\\"2018-07-01\\\"},{\\\"cycleType\\\":\\\"q\\\",\\\"detailCode\\\":\\\"302030100\\\",\\\"itemCode\\\":\\\"30203\\\",\\\"itemName\\\":\\\"增值税教育费附加\\\",\\\"taxEndDate\\\":\\\"9999-12-31\\\",\\\"taxRate\\\":\\\"0.03\\\",\\\"taxStartDate\\\":\\\"2018-07-01\\\"},{\\\"cycleType\\\":\\\"q\\\",\\\"detailCode\\\":\\\"302160100\\\",\\\"itemCode\\\":\\\"30216\\\",\\\"itemName\\\":\\\"增值税地方教育附加\\\",\\\"taxEndDate\\\":\\\"9999-12-31\\\",\\\"taxRate\\\":\\\"0.02\\\",\\\"taxStartDate\\\":\\\"2018-07-01\\\"}],\\\"pmdmCode\\\":\\\"\\\",\\\"qxqz\\\":\\\"9999-12-31\\\",\\\"sl\\\":\\\"0.02\\\",\\\"sn\\\":\\\"302160200\\\",\\\"taxCode\\\":\\\"302160200\\\",\\\"xmdmCode\\\":\\\"\\\",\\\"zcqq\\\":\\\"2018-07-01\\\",\\\"zspmMc\\\":\\\"增值税地方教育附加\\\",\\\"zsxmMc\\\":\\\"地方教育附加\\\"}]}\",\"code\":200,\"instId\":\"25E5BBD0478711E8AD4CD51BE542664F\",\"message\":\"\",\"seq\":\"ccc7dfa89b9e4ff9bf190e5a36b7de5b\",\"sn\":\"SZ0050\"}";
        TaskCallBackResponse taskCallBackResponse = JSON.parseObject(requestBody, TaskCallBackResponse.class);

        MvcResult result = mvc.perform(
                MockMvcRequestBuilders.post("/task/callback")
                        .contentType(MediaType.APPLICATION_JSON_UTF8_VALUE)
                        .content(mapper.writeValueAsString(taskCallBackResponse)))
                .andDo(print())
                .andExpect(MockMvcResultMatchers.status().isOk())
                .andReturn();
        //TODO result 对应业务自己的操作判断是否
        String body = result.getResponse().getContentAsString();
        System.out.println("body:" + body);
    }

    @Override
    public Object controller() {
        return taskCallBackController;
    }
}
